#!/bin/bash
# Usage 
# set cooling mode, temerature and fan speed
# > script.sh cool 20 high
# > script.sh cool 18 low
#
# just set coolingmode+temp
# > script.sh cool 22
#
# toggle power
# > script.sh toggle
#
# set fan mode
# > script.sh fan
# set fan mode with low/high
# > script.sh fan <low/high>
#
# set dry mode
# > script.sh dry

send() {
	mosquitto_pub -t "ir/heatpump/send" -m "$1"
}
down(){
	send "9052 4493 582 531 574 577 582 554 576 556 579 1643 602 551 553 580 556 576 557 1689 578 1664 580 1662 583 548 580 553 553 1670 598 1664 557 1664 603 1661 555 576 579 1644 575 1686 606 505 602 552 556 555 578 577 557 577 555 1690 579 530 579 574 583 1663 554 1667 602 1642 576 1687 579"
}
up(){
	send "9329 4516 669 493 669 493 672 467 692 492 672 1613 692 490 672 491 671 490 673 1611 693 1612 694 1611 695 489 672 490 673 1611 696 1609 695 1611 694 1613 693 468 695 1612 694 467 695 1611 693 469 692 492 672 490 671 468 696 1612 692 469 694 1634 672 491 671 1612 694 1634 672 1613 693"
}
power(){
	send "9214 4475 666 463 687 485 666 463 687 486 666 1595 688 485 665 465 688 484 666 1597 687 1598 686 1595 688 486 666 484 667 1596 687 1596 688 1617 668 486 666 463 687 464 687 465 687 464 686 464 688 486 665 464 689 1617 668 1596 689 1596 689 1595 689 1596 690 1594 690 1617 668 1596 689"
}
cool(){
	send "8962 4485 551 552 578 550 577 551 577 551 577 1662 577 551 577 551 577 550 577 1661 577 1663 576 1662 576 551 577 551 576 1660 579 1661 577 1660 577 553 576 551 577 1661 577 551 576 1661 577 551 576 551 577 551 577 1660 577 1661 577 551 576 1662 576 552 576 1662 576 1662 576 1661 577 "
}
dry(){
	send "4460 574 553 575 552 576 552 575 552 576 1662 576 552 577 551 576 552 576 1662 576 1662 576 1659 579 551 576 552 576 1661 577 1663 575 1662 577 552 576 552 576 1661 578 1661 577 551 576 551 577 551 576 551 577 1661 577 1661 577 551 577 551 577 1661 576 1661 577 1661 578 1661 577 "
}
fan(){
	send "9064 4358 677 451 678 451 677 450 677 451 678 1562 677 450 677 451 678 451 675 1563 677 1560 677 1562 676 453 675 451 677 1560 679 1560 677 1561 678 452 675 451 677 451 676 1561 677 452 675 452 676 450 678 450 677 1562 676 1562 676 1562 676 451 677 1561 676 1562 676 1562 676 1562 676 "
}

high(){
	send "8979 4468 577 552 577 554 576 553 577 553 576 1654 589 553 576 553 577 553 577 1688 553 1688 554 1687 553 554 576 554 576 1666 575 1666 576 1667 575 556 574 1668 575 1664 577 554 575 1666 575 555 576 554 575 554 576 1666 575 554 576 554 576 1667 574 554 576 1666 576 1663 579 1666 575 "
}
low(){
	send "9002 4490 557 555 578 573 581 529 602 529 604 1642 602 528 628 525 582 528 579 1666 577 1687 584 1638 603 530 600 530 606 1638 579 1687 583 1640 603 530 603 1663 557 552 582 1663 578 574 556 554 579 553 578 554 577 1688 582 528 603 1643 603 528 600 1643 579 1688 582 1662 557 1688 582 "
}

mode=$1
target=$2
if [[ "$mode" = "toggle" ]]; then
        power
        exit
fi
if [[ "$mode" = "fan" ]]; then
	fan
	[[ "$2" = "high" ]] && high
	[[ "$2" = "low" ]] && low
	exit
fi
if [[ "$mode" = "cool" ]]; then
	cool
	for i in $(seq 1 10); do down; sleep 0.1; done
	down
	sleep 1
	for i in $(seq 17 $target); do up; sleep 0.2; done

	[[ "$3" = "high" ]] && high
	[[ "$3" = "low" ]] && low

	exit
fi
if [[ "$mode" = "dry" ]]; then
	dry
	exit
fi
